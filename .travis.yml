language: node_js
node_js:
  - 12
  - 13
  - 14

cache: yarn

script:
  - which node
  - which npm
  - which npx
  - which yarn
  - ./bin/run --version
  - ./bin/run --help
  - yarn run test

jobs:
  include:
    # Define the release stage that runs semantic-release
    - stage: release
      node_js: lts/*
      # Advanced: optionally overwrite your default `script` step to skip the tests
      script: skip
      before_deploy:
        - sudo apt-get update
        - sudo apt-get -y install bzip2 p7zip-full build-essential fakeroot devscripts nsis
      deploy:
        provider: script
        skip_cleanup: true
        script:
          - sudo -i $HOME/node_modules/.bin/npx semantic-release
